# 사용자 스토리 (User Stories)

## 1. 상품 조회 및 검색

### US-001: 상품 목록 조회
**As a** 고객  
**I want to** 판매 중인 상품 목록을 조회하고 싶다  
**So that** 구매할 상품을 찾을 수 있다

**인수 조건 (Acceptance Criteria)**
- [ ] 상품 목록이 조회된다
- [ ] 각 상품의 이름, 가격, 재고 수량이 표시된다
- [ ] 재고가 0인 상품도 목록에 표시된다

**테스트 시나리오**

```gherkin
Given 상품이 10개 등록되어 있고
When 상품 목록을 조회하면
Then 상품 목록이 반환된다 And 각 상품의 이름, 가격, 재고가 포함되어 있다
```

---

### US-002: 상품 상세 정보 조회
**As a** 고객  
**I want to** 특정 상품의 상세 정보를 조회하고 싶다  
**So that** 상품의 가격과 재고를 확인하고 구매를 결정할 수 있다

**인수 조건**
- [ ] 상품 ID로 상품 정보를 조회할 수 있다
- [ ] 상품명, 가격, 재고 수량이 표시된다
- [ ] 존재하지 않는 상품 조회 시 에러가 반환된다

**테스트 시나리오**

```gherkin
Given 상품 ID가 1인 상품이 존재하고
When 해당 상품을 조회하면
Then 상품 정보가 반환된다

Given 존재하지 않는 상품 ID로 조회하면
Then "상품이 존재하지 않습니다" 에러가 반환된다
```

---

### US-003: 인기 상품 조회
**As a** 고객  
**I want to** 최근 인기 있는 상품을 보고 싶다  
**So that** 다른 사람들이 많이 구매하는 상품을 확인할 수 있다

**인수 조건**
- [ ] 최근 3일간 판매량 기준 Top 5 상품이 조회된다
- [ ] 상품명, 총 판매 수량이 표시된다
- [ ] 판매량이 많은 순서대로 정렬된다

**테스트 시나리오**

```gherkin
Given 최근 3일간 여러 상품이 판매되었고
When 인기 상품 Top 5를 조회하면
Then 판매량이 많은 순서대로 5개 상품이 반환된다 And 각 상품의 총 판매 수량이 포함되어 있다
```

---

## 2. 장바구니

### US-004: 장바구니에 상품 추가
**As a** 고객  
**I want to** 원하는 상품을 장바구니에 담고 싶다  
**So that** 나중에 한번에 주문할 수 있다

**인수 조건**
- [ ] 상품 ID와 수량을 지정하여 장바구니에 추가할 수 있다
- [ ] 이미 담긴 상품은 수량이 증가한다

**테스트 시나리오**

```gherkin
Given 장바구니에 상품 A가 담겨있지 않고
When 상품 A를 3개 장바구니에 추가하면
Then 장바구니에 상품 A가 3개 담긴다

Given 장바구니에 이미 상품 A가 3개 담겨있고
When 상품 A를 2개 더 추가하면
Then 장바구니의 상품 A 수량이 5개가 된다
```

---

### US-005: 장바구니 조회
**As a** 고객  
**I want to** 내 장바구니를 조회하고 싶다  
**So that** 담아둔 상품들을 확인할 수 있다

**인수 조건**
- [ ] 내가 담은 모든 상품이 조회된다
- [ ] 각 상품의 이름, 가격, 수량이 표시된다

**테스트 시나리오**

```gherkin
Given 내 장바구니에 상품 A(5000원) 2개, 상품 B(3000원) 1개가 담겨있고
When 장바구니를 조회하면
Then 2개의 상품이 반환된다
```

---

### US-006: 장바구니 상품 삭제
**As a** 고객  
**I want to** 장바구니의 상품을 삭제하고 싶다  
**So that** 구매하지 않을 상품을 제거할 수 있다

**인수 조건**
- [ ] 장바구니 아이템 ID로 상품을 삭제할 수 있다
- [ ] 삭제 후 장바구니 목록이 갱신된다

**테스트 시나리오**

```gherkin
Given 장바구니에 상품 A, B, C가 담겨있고
When 상품 B를 삭제하면
Then 장바구니에 상품 A, C만 남는다
```

---

## 3. 주문 및 결제

### US-007: 장바구니 상품 주문
**As a** 고객  
**I want to** 장바구니의 상품들을 주문하고 싶다  
**So that** 상품을 구매할 수 있다

**인수 조건**
- [ ] 장바구니의 모든 상품 재고가 확인된다
- [ ] 재고가 충분하면 주문이 생성된다
- [ ] 주문 시 재고가 차감된다
- [ ] 하나라도 재고가 부족하면 전체 주문이 실패한다

**테스트 시나리오**

```gherkin
Given 장바구니에 상품 A(재고 10개) 3개, 상품 B(재고 5개) 2개가 담겨있고
When 주문을 요청하면
Then 주문이 성공한다 And 상품 A의 재고는 7개가 된다 And 상품 B의 재고는 3개가 된다

Given 장바구니에 상품 A(재고 2개) 5개가 담겨있고
When 주문을 요청하면
Then "재고가 부족합니다" 에러가 반환된다 And 주문이 생성되지 않는다
```

---

### US-008: 포인트로 결제
**As a** 고객  
**I want to** 포인트를 사용하여 결제하고 싶다  
**So that** 주문을 완료할 수 있다

**인수 조건**
- [ ] 포인트 잔액이 충분하면 결제가 완료된다
- [ ] 결제 금액만큼 포인트가 차감된다
- [ ] 잔액이 부족하면 결제가 실패한다
- [ ] 포인트 거래 내역이 기록된다

**테스트 시나리오**

```gherkin
Given 내 포인트 잔액이 50000원이고 And 주문 금액이 30000원일 때
When 결제를 요청하면
Then 결제가 성공한다 And 포인트 잔액은 20000원이 된다 And 포인트 사용 내역이 기록된다

Given 내 포인트 잔액이 10000원이고 And 주문 금액이 30000원일 때
When 결제를 요청하면
Then "포인트 잔액이 부족합니다" 에러가 반환된다
```

---

### US-009: 쿠폰 할인 적용
**As a** 고객  
**I want to** 결제 시 쿠폰을 사용하고 싶다  
**So that** 할인된 가격으로 구매할 수 있다

**인수 조건**
- [ ] 보유한 쿠폰 중 하나를 선택하여 사용할 수 있다
- [ ] 쿠폰 할인이 적용된 금액으로 결제된다
- [ ] 만료된 쿠폰은 사용할 수 없다
- [ ] 이미 사용한 쿠폰은 재사용할 수 없다

**테스트 시나리오**

```gherkin
Given 내 포인트가 50000원이고 And 5000원 할인 쿠폰을 보유하고 있고 And 주문 금액이 30000원일 때
When 쿠폰을 적용하여 결제하면
Then 최종 결제 금액은 25000원이다 And 포인트는 25000원 차감된다 And 쿠폰이 사용 처리된다

Given 만료된 쿠폰으로 결제를 시도하면
Then "만료된 쿠폰입니다" 에러가 반환된다

Given 이미 사용한 쿠폰으로 결제를 시도하면
Then "이미 사용된 쿠폰입니다" 에러가 반환된다
```

---

## 4. 쿠폰

### US-010: 쿠폰 발급
**As a** 고객  
**I want to** 선착순 쿠폰을 발급받고 싶다  
**So that** 할인 혜택을 받을 수 있다

**인수 조건**
- [ ] 수량이 남아있으면 쿠폰이 발급된다
- [ ] 발급 시 만료일시가 자동 계산된다 (발급일 + 유효일수)
- [ ] 동일 쿠폰은 중복 발급되지 않는다
- [ ] 수량이 소진되면 발급이 실패한다

**테스트 시나리오**

```gherkin
Given 유효기간이 7일인 한정 쿠폰이 총 100개 존재하고 And 현재 50개가 발급되었을 때
When 쿠폰 발급을 요청하면
Then 쿠폰이 발급된다 And 발급된 쿠폰의 만료일시는 발급일 + 7일이다

Given 이미 발급받은 쿠폰을 다시 요청하면
Then "이미 발급받은 쿠폰입니다" 에러가 반환된다

Given 쿠폰이 모두 소진되었을 때
When 쿠폰 발급을 요청하면
Then "쿠폰이 모두 소진되었습니다" 에러가 반환된다
```

---

### US-011: 보유 쿠폰 조회
**As a** 고객  
**I want to** 내가 보유한 쿠폰을 확인하고 싶다  
**So that** 사용 가능한 쿠폰을 파악할 수 있다

**인수 조건**
- [ ] 사용 가능한 쿠폰만 조회된다 (미사용 + 미만료)
- [ ] 쿠폰명, 할인 금액, 만료일시가 표시된다
- [ ] 만료일이 가까운 순서로 정렬된다

**테스트 시나리오**

```gherkin
Given 내가 쿠폰 A(7일 후 만료), 쿠폰 B(3일 후 만료), 쿠폰 C(이미 만료)를 보유하고 있을 때
When 사용 가능한 쿠폰을 조회하면
Then 쿠폰 B, 쿠폰 A 순서로 2개가 반환된다 And 만료된 쿠폰 C는 조회되지 않는다
```

---

## 5. 포인트

### US-012: 포인트 충전
**As a** 고객  
**I want to** 포인트를 충전하고 싶다  
**So that** 상품을 구매할 수 있다

**인수 조건**
- [ ] 충전 금액만큼 포인트가 증가한다
- [ ] 충전 내역이 기록된다
- [ ] 0원 이하는 충전할 수 없다

**테스트 시나리오**

```gherkin
Given 내 포인트 잔액이 10000원이고
When 30000원을 충전하면
Then 포인트 잔액은 40000원이 된다 And 충전 내역이 기록된다

Given 0원 이하를 충전하려고 하면
Then "유효하지 않은 금액입니다" 에러가 반환된다
```

---

### US-013: 포인트 내역 조회
**As a** 고객  
**I want to** 포인트 사용/충전 내역을 확인하고 싶다  
**So that** 포인트 변동을 추적할 수 있다ㅊ

**인수 조건**
- [ ] 모든 충전/사용 내역이 조회된다
- [ ] 거래 일시, 금액, 유형(충전/사용)이 표시된다
- [ ] 최신 내역이 먼저 표시된다

**테스트 시나리오**

```gherkin
Given 포인트를 2번 충전하고 1번 사용했을 때
When 포인트 내역을 조회하면
Then 3개의 거래 내역이 반환된다 And 최신 거래가 먼저 표시된다
```

---

## 6. 데이터 연동

### US-014: 주문 데이터 외부 전송
**As a** 시스템 관리자  
**I want to** 주문 완료 시 외부 시스템으로 데이터가 전송되길 원한다  
**So that** 외부 시스템과 주문 정보를 공유할 수 있다

**인수 조건**
- [ ] 주문 완료 시 자동으로 외부 시스템에 전송된다
- [ ] 외부 시스템 장애 시에도 주문은 정상 처리된다

**테스트 시나리오**

```gherkin
Given 주문이 정상적으로 완료되었을 때
Then 외부 시스템으로 데이터를 전송한다

Given 외부 시스템이 응답하지 않을 때
When 주문을 완료하면
Then 주문은 정상 처리된다
```

---

## 7. 동시성 제어

### US-015: 동시 주문 시 재고 정합성
**As a** 시스템  
**I want to** 여러 고객이 동시에 주문해도 재고가 정확하게 처리되길 원한다  
**So that** 재고 수량의 정합성을 보장할 수 있다

**인수 조건**
- [ ] 100명이 동시에 주문해도 재고가 정확히 차감된다
- [ ] 재고 이상으로 판매되지 않는다

**테스트 시나리오**

```gherkin
Given 상품 A의 재고가 10개이고
When 100명이 동시에 상품 A를 1개씩 주문하면
Then 10명만 주문에 성공한다 And 90명은 "재고가 부족합니다" 에러를 받는다 And 상품 A의 재고는 0개가 된다
```

---

### US-016: 동시 쿠폰 발급 시 정합성
**As a** 시스템  
**I want to** 여러 고객이 동시에 쿠폰을 요청해도 수량이 정확하게 처리되길 원한다  
**So that** 쿠폰 발급 수량의 정합성을 보장할 수 있다

**인수 조건**
- [ ] 1000명이 동시에 요청해도 한정 수량만 발급된다
- [ ] 수량 이상으로 발급되지 않는다

**테스트 시나리오**

```gherkin
Given 총 100개 한정 쿠폰이 존재하고
When 1000명이 동시에 쿠폰 발급을 요청하면
Then 100명만 발급에 성공한다 And 900명은 "쿠폰이 모두 소진되었습니다" 에러를 받는다 And 발급된 쿠폰 수량은 100개이다
```
